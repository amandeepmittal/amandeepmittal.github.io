{"componentChunkName":"component---src-templates-post-js","path":"/building-a-rest-api-with-koajs","webpackCompilationHash":"c3a562291cd8e443a353","result":{"data":{"site":{"siteMetadata":{"title":"Aman Mittal - Fullstack Developer","description":"Aman Mittal - Developer and Technical writer.","author":{"name":"Aman Mittal"},"keywords":["Fullstack Developer"]}},"mdx":{"frontmatter":{"title":"Building a REST API with KoaJS","date":"October 16, 2018","author":"Aman Mittal","banner":null,"slug":"building-a-rest-api-with-koajs","keywords":null},"code":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"building-a-rest-api-with-koajs\",\n  \"date\": \"2018-10-16T00:00:00.000Z\",\n  \"title\": \"Building a REST API with KoaJS\",\n  \"categories\": [\"nodejs\"],\n  \"description\": \"How to Use Koa.js to write server-side code that uses node.js as the runtime engine.\",\n  \"published\": true,\n  \"author\": \"Aman Mittal\",\n  \"banner\": null\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/2560/1*BhGdFZMiLyIsU0XICVaaJQ.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"There are quite a few \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://crowdbotics.com/build/node-js?utm_source=medium&utm_campaign=nodeh&utm_medium=node&utm_content=koa-rest-api\"\n  }), \"Node.js\"), \" frameworks available for web development to build a back-end server for a web or a mobile application. The most popular framework is ExpressJS, which has been used widely in the industry for a long time.\"), mdx(\"p\", null, \"In this article, however, \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"we are going to discuss\"), \" \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://koajs.com\"\n  }), mdx(\"strong\", {\n    parentName: \"a\"\n  }, \"Koa\")), mdx(\"strong\", {\n    parentName: \"p\"\n  }, \", to write server-side code that uses Node.js as the runtime engine. In this tutorial, I will show how to build a\"), \" \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://blog.crowdbotics.com/how-to-write-an-api-in-3-lines-of-code-with-django-rest-framework/\"\n  }), mdx(\"strong\", {\n    parentName: \"a\"\n  }, \"small REST API\")), \" \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"then test it using a REST Client.\")), mdx(\"h3\", null, \"What is\\xA0Koa?\"), mdx(\"p\", null, \"Koa is designed and built by the team behind ExpressJS with additions such as promises and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"async/await\"), \" support in its core. These ES2015 features are used to tackle API's asynchronous calls. Distributed as a lightweight Node.js framework, Koa provides a minimal interface for developing web applications and APIs.\"), mdx(\"p\", null, \"Koa has features that help JavaScript developers who want to use and leverage Node.js to accelerate the development of APIs and web applications. I have been using Koa for some of my latest back-end applications and I would love to share my knowledge to get you started.\"), mdx(\"h3\", null, \"Features of\\xA0Koa\"), mdx(\"p\", null, \"Some of the features of the Koa framework include:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Designed as a lightweight and flexible framework for Node.js\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Support for ECMAScript 6 (/ES2015) by default\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Developers can use generators as functions to stop and resume the code execution\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Simplifies the use of Error handling by using middleware more effectively\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Identifies and understands all HTTP methods\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Even before Express, Koa had support for \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"async/await\"))), mdx(\"p\", null, \"To use this framework, the only two requirements for runing the code examples below is to have Node.js installed in your local machine along with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm\"), \" to access and install it as a dependency. The second requirement is to have a general understanding of JavaScript as a programming language.\"), mdx(\"h3\", null, \"Getting Started\"), mdx(\"p\", null, \"To start using Koa as a server-side framework you will have to first install it. Create a directory where you will want to place all the project related files. We will first initialize it as a Node.js project.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"# First initialize an empty directory\\nnpm init -y\\n\")), mdx(\"p\", null, \"This will help us generate a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file that holds all the records of dependencies we add to our project using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm\"), \". I am using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-y\"), \" flag to skip the questionnaire prompted by npm. You will get a similar result once it is done.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"{\\n  \\\"name\\\": \\\"koa-rest-api-tut\\\",\\n  \\\"version\\\": \\\"0.0.1\\\",\\n  \\\"description\\\": \\\"\\\",\\n  \\\"main\\\": \\\"index.js\\\",\\n  \\\"scripts\\\": {\\n    \\\"test\\\": \\\"echo \\\\\\\"Error: no test specified\\\\\\\" && exit 1\\\"\\n  },\\n  \\\"author\\\": \\\"Aman Mittal\\\",\\n  \\\"license\\\": \\\"MIT\\\"\\n}\\n\")), mdx(\"p\", null, \"Next step is to add Koa as a local dependency. I am sure you know what a local dependency here means. If not, please refer to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"[npm](https://docs.npmjs.com/)\"), \" \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.npmjs.com/\"\n  }), \"documentation\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"npm install -S koa\\n\")), mdx(\"p\", null, \"So far so good. Now we can get started and build our application. However, please note that to use Koa either on your local machine or deploy any server-side project that uses it, \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"you need to have Node.js version equal to or greater than\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"_v7.6.0_\"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \".\")), mdx(\"h3\", null, \"Our First Koa\\xA0App\"), mdx(\"p\", null, \"To understand Koa better, and point out the differences with a commonly used framework such as ExpressJS, we are going to first write an obligatory \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Hello World\"), \" program.\"), mdx(\"p\", null, \"Below, we create a route in a file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.js\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// app.js\\nconst Koa = require('koa')\\nconst app = new Koa()\\n\\n// Our First Route\\napp.use(async ctx => {\\n  ctx.body = 'Hello World'\\n})\\n\\n// Bootstrap the server\\napp.listen(3000)\\n\")), mdx(\"p\", null, \"Now, open the terminal and run the following command:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"node app.js\\n\")), mdx(\"p\", null, \"If you are not prompted with an error, that means the server ran successfully.\"), mdx(\"p\", null, \"Right now, we are not getting anything exciting from the terminal. If you go to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:3000\"), \" in your browser window, you should see a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Hello World\"), \" message greeting you!\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*vmF-dRrg83Uq4Zt6BbkAEg.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"To understand more about what is happening, let\\u2019s import the Koa library into our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.js\"), \" file.\"), mdx(\"p\", null, \"Next, we define an instance called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app\"), \" that will access all the methods that are included in Koa's API such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"use()\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"listen()\"), \". \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.use()\"), \" is how th middleware function is defined. We are using this middleware function as a route. The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.listen()\"), \" is how the server knows to run on a port number specified such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"3000\"), \".\"), mdx(\"h3\", null, \"Wait, what is\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"ctx\"), \"?\"), mdx(\"p\", null, \"Another important feature that we use in our bare minimum example is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ctx\"), \". I do hope you noticed it there.\"), mdx(\"p\", null, \"We are using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ctx\"), \" as an argument to the asynchronous middleware function. It is called \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Context\"), \" in Koa and it encapsulates \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"request\"), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"response\"), \" objects into a single object. Unlike ExpressJS, that requires request and response as separate objects passed as arguments. For example:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// request and response objects in ExpressJS\\n\\napp.use((request, response) => {\\n  // ... rest of the route\\n})\\n\")), mdx(\"p\", null, \"In Koa, a context is created for every request that comes to the server and is always referenced as a middleware.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// request and response as context in Koa\\napp.use(async ctx => {\\n  ctx.request\\n  ctx.response\\n})\\n\")), mdx(\"h3\", null, \"Side Tip: Installing nodemon\"), mdx(\"p\", null, \"Before I start on REST APIs, the core of the article, I want to introduce a great tip that is helpful in building a Node.js application. During the development mode, irrespective of the framework I am using, I use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nodemon\"), \" as a dependency to watch for file changes and automatically restart the application. This eliminates the need of running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node [filename].js\"), \" command again and again. You can totally, skip this step and move on the next one where I show the steps for writing the REST API.\"), mdx(\"p\", null, \"This small utility has such an impact on my workflow that it saves hours of development chores. So let me show you how to set it up in our demo application. I am using the same project as previous \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Hello World\"), \" example to demonstrate this. Write the following command to install it.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"npm install -D nodemon\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-D\"), \" flag is used to tell npm to install the current dependency as a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"devDependency\"), \". The difference between it and a normal dependency is that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"devDependencies\"), \" tend to work only in development environment. They are not installed in a production environment since there is no use of them there. Other types of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"devDependencies\"), \" you might come across when writing Node applications are linting tools such as ESLint.\"), mdx(\"p\", null, \"Once, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nodemon\"), \" is installed, append the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file and an npm script.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"\\\"scripts\\\":{\\n  \\\"dev\\\": \\\"nodemon app.js\\\"\\n}\\n\")), mdx(\"p\", null, \"Point this script to the initial file of the Koa application, in our case, it is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.js\"), \". To run the application now, all you have to type is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run dev\"), \" command in your terminal. This time, you will see a few messages suddenly prompted in the terminal. These messages are provided by \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nodemon\"), \".\"), mdx(\"h3\", null, \"Building the REST\\xA0API\"), mdx(\"p\", null, \"Finally, you have arrived at the point where you can start building the REST API. You have to install dependencies for the API to work. Let\\u2019s install them.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"npm i -S koa-body koa-router\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"What are these dependencies for?\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"koa-body\"), \" is a body-parser middleware. It supports \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"urlencoded\"), \", multi-part and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"json\"), \" request bodies. Basically, it helps to create and respond to HTTP \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST\"), \" requests which are available as a form field, or a file upload, etc. It tells the server that the incoming request from the client has a body of data. ExpressJS uses the same approach in handling body requests.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"koa-router\"), \" is the routing middleware that provides ExpressJS style routing using HTTP verbs. It has methods that you can directly use in the application Such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.get()\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.post()\"), \", etc.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note:\"), \" I will be mocking data in this application for the sake of brevity and clear understanding of framework\\u2019s concepts. If you want to, you can use the database of your choice. The structure of data is not complex.\"), mdx(\"p\", null, \"Write the following code in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.js\"), \" file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// app.js\\n\\nconst Koa = require('koa')\\nconst koaBody = require('koa-body')\\n\\n// create app instance\\nconst app = new Koa()\\n\\n// middleware functions\\napp.use(koaBody())\\n\\n// Require the router here\\n\\n// use the router here\\n\\napp.listen(3000)\\n\")), mdx(\"p\", null, \"After body-parser middleware, you are going to have the routes. I am using another file to describe the routes to separate the code for clear understanding. Create a new file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"books.js\"), \". Define the following inside that file with the data to mock.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// books.js\\n\\nconst Router = require('koa-router')\\n\\n// Prefix all routes with: /books\\nconst router = new Router({\\n  prefix: '/books'\\n})\\n\\nlet books = [\\n  { id: 101, name: 'Fight Club', author: 'Chuck Palahniuk' },\\n  { id: 102, name: 'Sharp Objects', author: 'Gillian Flynn' },\\n  { id: 103, name: 'Frankenstein', author: 'Mary Shelley' },\\n  { id: 101, name: 'Into The Wild', author: 'John Krakauer' }\\n]\\n\\n// Routes will go here\\n\\nmodule.exports = router\\n\")), mdx(\"p\", null, \"First, I am importing the necessary dependency to create routes: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"koa-router\"), \". The next step is to create an instance of this newly imported dependency. Notice the prefix part: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/books\"), \". Using a prefix for the routes is how you can define and categorized different routes. You can also use this technique to classify the different API versions such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"v1\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"v2\"), \", etc.\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"books\"), \" array is the mock data. It contains information about books and each book is represented by a separate object inside the array. Each object further has three data fields: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"name\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"author\"), \".\"), mdx(\"p\", null, \"Let\\u2019s build the first route of our API.\"), mdx(\"h3\", null, \"Creating a route to handle GET\\xA0request\"), mdx(\"p\", null, \"Below is the code for handling a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GET\"), \" request in Koa. Add the following code to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"books.js\"), \".\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// books.js\\nrouter.get('/', (ctx, next) => {\\n  ctx.body = books\\n  next()\\n})\\n\")), mdx(\"p\", null, \"The callback function attached to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"router.get()\"), \" contains two arguments. I have already explained to you what \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ctx\"), \" or context is. The last argument is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"next()\"), \". This is often used in middleware functions. Any middleware function invokes this function to indicate the current middleware function has suspended running and the next middleware function available must be invoked.\"), mdx(\"p\", null, \"This callback function traverses through the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"books\"), \" array when to send the response. To run this, you have to first include the routes file in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app.js\"), \" and invoke them.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// app.js\\nconst Koa = require('koa')\\nconst koaBody = require('koa-body')\\n\\nconst app = new Koa()\\n\\n// Set up body parsing middleware\\napp.use(koaBody())\\n\\n// Require the Router we defined in books.js\\nlet books = require('./books.js')\\n\\n// Use the Router on the sub route /books\\napp.use(books.routes())\\n\\napp.listen(3000)\\n\")), mdx(\"p\", null, \"Next step is to run the command: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run dev\"), \" and visit the url \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:3000/books\"), \" to see the following result.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*d-GFucqnhOEIeORSytPH4w.png\",\n    \"alt\": null\n  }))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Congratulations! \\uD83C\\uDF89 You just build your first route using\\xA0Koa.\"))), mdx(\"p\", null, \"Next step is to create a route to fetch a book by its \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \". It is going to use the similar approach as the previous route, plus we see how to extract information from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"request.params\"), \" object of an incoming request.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// books.js\\nrouter.get('/:id', (ctx, next) => {\\n  let getCurrentBook = books.filter(function(book) {\\n    if (book.id == ctx.params.id) {\\n      return true\\n    }\\n  })\\n\\n  if (getCurrentBook.length) {\\n    ctx.body = getCurrentBook[0]\\n  } else {\\n    ctx.response.status = 404\\n    ctx.body = 'Book Not Found'\\n  }\\n  next()\\n})\\n\")), mdx(\"p\", null, \"Routing parameters are named segments that are used capture the values specified in the URL. In our case, such as\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \":id\"), \". Above, we define a routing middleware function that can handle incoming requests from URLs such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http:localhost:3000/books/103\"), \". Enter this URL in your browser window and you will get the following result.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*-F6g2j_QsvwBjXUdrVsZhw.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"In case of when \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \" does not exist or is invalid, you have to send an error message with an HTTP status of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"404\"), \".\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*BKDmJ80xYVoOsVQTNaMiKw.png\",\n    \"alt\": null\n  }))), mdx(\"h3\", null, \"Handling a POST\\xA0request\"), mdx(\"p\", null, \"The last route you are going to build for this demonstration is going to handle \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST\"), \" requests.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// books.js\\n\\nrouter.post('/new', (ctx, next) => {\\n  // Check if any of the data field not empty\\n  if (\\n    !ctx.request.body.id ||\\n    !ctx.request.body.name ||\\n    !ctx.request.body.author\\n  ) {\\n    ctx.response.status = 400\\n    ctx.body = 'Please enter the data'\\n  } else {\\n    let newBook = books.push({\\n      id: ctx.request.body.id,\\n      name: ctx.request.body.name,\\n      author: ctx.request.body.author\\n    })\\n    ctx.response.status = 201\\n    ctx.body = `New book added with id: ${ctx.request.body.id} & name: ${ctx.request.body.name}`\\n  }\\n  next()\\n})\\n\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/new\"), \" route is used for creating a new book add it into our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"books\"), \" array. I am using this to mock data and not real database so restarting the application will delete the newly added books. In the above routing middleware, the Koa Context object first checks if any of the data field required in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"request.body\"), \" is present or not. If one of them is missing, this routing middleware will be terminated and sends back an error to the user.\"), mdx(\"p\", null, \"If everything is fine, this routing middleware accepts the data and returns success message with correct HTTP status of code for creating a new record. To run this URL, I am using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"curl\"), \" command from my terminal but you can use any REST client such as Postman or Insomnia.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*qbXL75_xqOrtgE0UTXEPPw.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"For our all routes to be more descriptive and follow REST API pattern, I have re-written every \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ctx.body\"), \" object from each routing middleware function. Here is how the complete routing file looks so far.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// books.js\\nconst Router = require('koa-router');\\n\\n// Prefix all routes with /books\\nconst router = new Router({\\n    prefix: '/books'\\n});\\n\\nlet books = [\\n    { id: 101, name: 'Fight Club', author: 'Chuck Palahniuk' },\\n    { id: 102, name: 'Sharp Objects', author: 'Gillian Flynn' },\\n    { id: 103, name: 'Frankenstein', author: 'Mary Shelley' },\\n    { id: 104, name: 'Into The Willd', author: 'Jon Krakauer' }\\n];\\n\\n// Routes will go here\\nrouter.get('/', (ctx, next) => {\\n    ctx.body = {\\n        status: 'success',\\n        message: books\\n    };\\n    next();\\n});\\n\\nrouter.get('/:id', (ctx, next) => {\\n    let getCurrentBook = books.filter(function(book) {\\n        if (book.id == ctx.params.id) {\\n            return true;\\n        }\\n    });\\n\\n    if (getCurrentBook.length) {\\n        ctx.body = getCurrentBook[0];\\n    } else {\\n        ctx.response.status = 404;\\n        ctx.body = {\\n            status: 'error!',\\n            message: 'Book Not Found with that id!'\\n        };\\n    }\\n    next();\\n});\\n\\nrouter.post('/new', (ctx, next) => {\\n    // Check if any of the data field not empty\\n    if (\\n        !ctx.request.body.id ||\\n        !ctx.request.body.name ||\\n        !ctx.request.body.author\\n    ) {\\n        ctx.response.status = 400;\\n        ctx.body = {\\n            status: 'error',\\n            message: 'Please enter the data';\\n    }\\n    } else {\\n        let newBook = books.push({\\n            id: ctx.request.body.id,\\n            name: ctx.request.body.name,\\n            author: ctx.request.body.author\\n        });\\n        ctx.response.status = 201;\\n        ctx.body = {\\n            status: 'success',\\n            message: `New book added with id: ${ctx.request.body.id} & name: ${\\n                ctx.request.body.name\\n            }`\\n        };\\n    }\\n    next();\\n});\\n\\nmodule.exports = router;\\n\")), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://cdn-images-1.medium.com/max/800/1*R2_CY-WOiEM2pqE-bLQbRg.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"This completes the basics of building a REST API using Koa as a Node.js framework. It\\u2019s a pretty minimal framework with all the necessary ways to tackle incoming requests and send the response back from the server. Koa also supports ready-made middleware functions to make use for logging, handling errors, testing, compression, and security.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"You can find the complete code used in this tutorial at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/amandeepmittal/koa-rest-api-tut\"\n  }), \"this Github repository\")), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/crowdbotics/building-a-rest-api-with-koajs-417c276929e2\"\n  }), \"Originally published at Crowdbotics\"))));\n}\n;\nMDXContent.isMDXComponent = true;"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f7ab86d9-056b-5458-a505-bff7b34e10ad","prev":{"id":"5e976c33-78a9-57d6-876b-d4971690e5f8","parent":{"name":"index","sourceInstanceName":"blog"},"excerpt":"React Native is a framework for building native mobile apps using JavaScript. React Native is based on the same core concepts as ReactJS, giving you, the developer, the power to compose a cross-platform mobile UI by writing JavaScript components…","fields":{"title":"Build a Todo app with React Native and Expo","slug":"build-to-do-app-react-native-expo","date":"2018-10-18T00:00:00.000Z"},"code":{"scope":""}},"next":{"id":"d9d8ebdd-348c-5c9f-8a1b-eb073dd45ded","parent":{"name":"index","sourceInstanceName":"blog"},"excerpt":"In this article, I will describe how to take an existing Web Application that is build using MongoDB, ExpressJS,  Node.js , and  React  (often called as MERN stack) on a deployment service like Heroku. If you have an existing application built using…","fields":{"title":"Deploy a MERN stack app on Heroku","slug":"deploy-a-mern-stack-app-on-heroku","date":"2018-10-12T00:00:00.000Z"},"code":{"scope":""}}}}}